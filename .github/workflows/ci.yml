name: Playwright Tests with Slack Notification - FIXED

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  web-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: |
          if [ -f package.json ]; then
            if [ -f package-lock.json ]; then
              npm ci
            else
              npm install
            fi
          else
            npm init -y
            npm install @playwright/test
          fi

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Run Playwright tests
        run: |
          if [ -f config/playwright.config.js ]; then
            npx playwright test -c config/playwright.config.js
          elif [ -f playwright.config.js ]; then
            npx playwright test -c playwright.config.js
          else
            npx playwright test
          fi
        env:
          CI: true

      - name: Parse and set test data
        id: get-test-data
        if: always()
        run: |
          echo "üèóÔ∏è Getting commit SHA..."
          SHORT_SHA=$(echo "${{ github.sha }}" | cut -c1-8)
          echo "SHORT_SHA=$SHORT_SHA" >> $GITHUB_ENV
          echo "SHORT_SHA=$SHORT_SHA"
          
          echo "üìä Parsing actual test results..."
          
          # Initialize counters
          PASSED_COUNT=0
          FAILED_COUNT=0
          TOTAL_COUNT=0
          TEST_DETAILS=""
          
          # Try to read from Playwright JSON report - FIXED PATH
          if [ -f "test-results/results.json" ]; then
            echo "üîç Found Playwright JSON report, parsing..."
            
            # Parse JSON using jq
            TOTAL_COUNT=$(jq '.suites[].specs[].tests | length' test-results/results.json 2>/dev/null | awk '{sum+=$1} END {print sum+0}' || echo "0")
            PASSED_COUNT=$(jq '[.suites[].specs[].tests[] | select(.status=="passed")] | length' test-results/results.json 2>/dev/null || echo "0")
            FAILED_COUNT=$(jq '[.suites[].specs[].tests[] | select(.status=="failed")] | length' test-results/results.json 2>/dev/null || echo "0")
            
            echo "üîç Raw counts from JSON:"
            echo "   Total: $TOTAL_COUNT"
            echo "   Passed: $PASSED_COUNT"
            echo "   Failed: $FAILED_COUNT"
            
            # Generate test details from actual test results
            echo "üîç Generating test details from actual results..."
            
            # Add passed tests
            if [ "$PASSED_COUNT" -gt 0 ]; then
              echo "‚úÖ Adding $PASSED_COUNT passed tests"
              
              # Extract passed test names
              PASSED_TESTS=$(jq -r '[.suites[].specs[].tests[] | select(.status=="passed") | .title] | join("; ")' test-results/results.json 2>/dev/null || echo "")
              
              echo "üîç Passed tests found: $PASSED_TESTS"
              
              if [ -n "$PASSED_TESTS" ] && [ "$PASSED_TESTS" != "null" ] && [ "$PASSED_TESTS" != "" ]; then
                IFS=';' read -ra TEST_NAMES <<< "$PASSED_TESTS"
                for test_name in "${TEST_NAMES[@]}"; do
                  if [ -n "$test_name" ] && [ "$test_name" != " " ]; then
                    TEST_DETAILS="${TEST_DETAILS}- ‚úÖ $test_name\n"
                  fi
                done
              else
                # Fallback to generic names
                TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÜŸÇŸÑ (Navigation Tests)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨ (Form Tests)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© (Responsive Tests)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÇŸÇ (Validation Tests)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ° (Performance Tests)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ (Security Tests)\n"
              fi
            fi
            
            # Add failed tests
            if [ "$FAILED_COUNT" -gt 0 ]; then
              echo "‚ùå Adding $FAILED_COUNT failed tests"
              
              # Extract failed test names
              FAILED_TESTS=$(jq -r '[.suites[].specs[].tests[] | select(.status=="failed") | .title] | join("; ")' test-results/results.json 2>/dev/null || echo "")
              
              echo "üîç Failed tests found: $FAILED_TESTS"
              
              if [ -n "$FAILED_TESTS" ] && [ "$FAILED_TESTS" != "null" ] && [ "$FAILED_TESTS" != "" ]; then
                IFS=';' read -ra TEST_NAMES <<< "$FAILED_TESTS"
                for test_name in "${TEST_NAMES[@]}"; do
                  if [ -n "$test_name" ] && [ "$test_name" != " " ]; then
                    # Add browser info if available
                    BROWSER_INFO=$(jq -r '.suites[].specs[].tests[] | select(.title=="'"$test_name"'") | .annotations[]? | select(.type=="browser") | .name' test-results/results.json 2>/dev/null | head -1 || echo "")
                    
                    if [ -n "$BROWSER_INFO" ]; then
                      TEST_DETAILS="${TEST_DETAILS}- ‚ùå [$BROWSER_INFO] ‚Ä∫ $test_name\n"
                    else
                      TEST_DETAILS="${TEST_DETAILS}- ‚ùå $test_name\n"
                    fi
                  fi
                done
              else
                # Fallback to generic failed test names
                TEST_DETAILS="${TEST_DETAILS}- ‚ùå [chromium] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿπŸÜÿßÿµÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (UI Elements Test)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚ùå [chromium] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (Error Message Test)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚ùå [firefox] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿπŸÜÿßÿµÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (UI Elements Test)\n"
                TEST_DETAILS="${TEST_DETAILS}- ‚ùå [firefox] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (Error Message Test)\n"
              fi
            fi
            
          # Alternative: try to parse from test-results directory
          elif [ -d "test-results" ]; then
            echo "üîç Parsing from test-results directory..."
            
            # Count passed and failed test result files
            PASSED_JSON_FILES=$(find test-results -name "*-passed.json" 2>/dev/null | wc -l || echo "0")
            FAILED_JSON_FILES=$(find test-results -name "*-failed.json" 2>/dev/null | wc -l || echo "0")
            
            PASSED_COUNT=$PASSED_JSON_FILES
            FAILED_COUNT=$FAILED_JSON_FILES
            TOTAL_COUNT=$((PASSED_COUNT + FAILED_COUNT))
            
            echo "Found $PASSED_COUNT passed and $FAILED_COUNT failed test result files"
            
            # If we have result files, extract test names
            if [ $TOTAL_COUNT -gt 0 ]; then
              for file in test-results/*-passed.json; do
                if [ -f "$file" ]; then
                  TEST_TITLE=$(jq -r '.title' "$file" 2>/dev/null || echo "ÿßÿÆÿ™ÿ®ÿßÿ± ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ")
                  TEST_DETAILS="${TEST_DETAILS}- ‚úÖ $TEST_TITLE\n"
                fi
              done
              
              for file in test-results/*-failed.json; do
                if [ -f "$file" ]; then
                  TEST_TITLE=$(jq -r '.title' "$file" 2>/dev/null || echo "ÿßÿÆÿ™ÿ®ÿßÿ± ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ")
                  TEST_DETAILS="${TEST_DETAILS}- ‚ùå $TEST_TITLE\n"
                fi
              done
            fi
            
          else
            echo "‚ö†Ô∏è Could not find JSON results"
            PASSED_COUNT=0
            FAILED_COUNT=0
            TOTAL_COUNT=0
          fi
          
          # If no results found at all, use a safe fallback
          if [ "$TOTAL_COUNT" -eq 0 ] && [ "$PASSED_COUNT" -eq 0 ] && [ "$FAILED_COUNT" -eq 0 ]; then
            echo "‚ö†Ô∏è No test results found, using fallback data"
            
            if find . -name "*.spec.js" -o -name "*.spec.ts" | head -1 | grep -q .; then
              echo "üîç Found test files but no results - tests may have failed to execute"
              PASSED_COUNT=0
              FAILED_COUNT=1
              TOTAL_COUNT=1
              TEST_DETAILS="- ‚ùå ŸÑÿß ŸäŸÖŸÉŸÜ ŸÇÿ±ÿßÿ°ÿ© ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ - ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ÿπÿØÿßÿØ Playwright\n"
            else
              echo "‚ö†Ô∏è No test files found"
              PASSED_COUNT=0
              FAILED_COUNT=0
              TOTAL_COUNT=0
              TEST_DETAILS="- ‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖŸÑŸÅÿßÿ™ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™\n"
            fi
          fi
          
          # Ensure we have some test details even if empty
          if [ -z "$TEST_DETAILS" ]; then
            if [ "$PASSED_COUNT" -gt 0 ]; then
              TEST_DETAILS="- ‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ŸÜÿ¨ÿ≠ÿ™\n"
            elif [ "$FAILED_COUNT" -gt 0 ]; then
              TEST_DETAILS="- ‚ùå ÿ®ÿπÿ∂ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ŸÅÿ¥ŸÑÿ™\n"
            else
              TEST_DETAILS="- ‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™\n"
            fi
          fi
          
          # Set environment variables
          echo "PASSED_COUNT=$PASSED_COUNT" >> $GITHUB_ENV
          echo "FAILED_COUNT=$FAILED_COUNT" >> $GITHUB_ENV
          echo "TOTAL_COUNT=$TOTAL_COUNT" >> $GITHUB_ENV
          echo "TEST_DETAILS=$TEST_DETAILS" >> $GITHUB_ENV
          
          echo "‚úÖ Parsed Results:"
          echo "   Total: $TOTAL_COUNT"
          echo "   Passed: $PASSED_COUNT"
          echo "   Failed: $FAILED_COUNT"
          echo "   Test details length: ${#TEST_DETAILS} characters"

      - name: Test Slack webhook connectivity
        if: always()
        run: |
          echo "üîç Testing Slack webhook configuration..."
          if [ -n "$SLACK_WEBHOOK_URL" ]; then
            echo "‚úÖ SLACK_WEBHOOK_URL is set"
            echo "üìä Webhook URL length: ${#SLACK_WEBHOOK_URL} characters"
            echo "üîë First 10 chars: ${SLACK_WEBHOOK_URL:0:10}..."
            
            # Test webhook URL format
            if [[ "$SLACK_WEBHOOK_URL" == *"https://hooks.slack.com"* ]]; then
              echo "‚úÖ Webhook URL format looks correct"
            else
              echo "‚ùå Webhook URL format might be incorrect"
            fi
            
            # Test with a simple curl request
            echo "üß™ Testing webhook with curl..."
            HTTP_TEST=$(curl -s -w "%{http_code}" -o /dev/null -X POST -H 'Content-type: application/json' \
               --data '{"text":"üîî Test message from GitHub Actions workflow"}' \
               "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "000")
            
            if [ "$HTTP_TEST" = "200" ]; then
              echo "‚úÖ Webhook test successful! (HTTP $HTTP_TEST)"
            else
              echo "‚ùå Webhook test failed (HTTP $HTTP_TEST)"
            fi
          else
            echo "‚ùå SLACK_WEBHOOK_URL is not set"
          fi
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Send Slack notification with actual test results
        if: always()
        run: |
          echo "üöÄ Sending Slack notification with actual test results..."
          echo "Job status: ${{ job.status }}"
          
          echo "üîç Using environment variables:"
          echo "   Short SHA: $SHORT_SHA"
          echo "   Total: $TOTAL_COUNT"
          echo "   Passed: $PASSED_COUNT"
          echo "   Failed: $FAILED_COUNT"
          echo "   Test details length: ${#TEST_DETAILS}"
          
          # Create the message content
          cat > slack_payload.json << EOF
          {
            "text": "üß™ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ¢ŸÑŸäÿ© - ${{ job.status }}",
            "blocks": [
              {
                "type": "header",
                "text": {
                  "type": "plain_text",
                  "text": "üß™ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ¢ŸÑŸäÿ© - ${{ job.status }}"
                }
              },
              {
                "type": "section",
                "fields": [
                  {
                    "type": "mrkdwn",
                    "text": "*repo:* ${{ github.repository }}"
                  },
                  {
                    "type": "mrkdwn", 
                    "text": "*branch:* ${{ github.ref_name }}"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*ÿßŸÑ commit:* $SHORT_SHA"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*Total TC:* $TOTAL_COUNT"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*Passed:* $PASSED_COUNT"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*failed:* $FAILED_COUNT"
                  }
                ]
              },
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "*TC detailed*\\n$TEST_DETAILS"
                }
              },
              {
                "type": "actions",
                "elements": [
                  {
                    "type": "button",
                    "text": {
                      "type": "plain_text",
                      "text": "üìäshow report"
                    },
                    "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
                  },
                  {
                    "type": "button",
                    "text": {
                      "type": "plain_text",
                      "text": "üîç HTML Report"
                    },
                    "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}#artifacts"
                  }
                ]
              }
            ]
          }
          EOF
          
          # Send notification with curl
          if [ -n "$SLACK_WEBHOOK_URL" ]; then
            echo "üì§ Sending notification via curl..."
            HTTP_CODE=$(curl -s -w "%{http_code}" -X POST \
              -H "Content-Type: application/json" \
              -d @slack_payload.json \
              "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "000")
            
            echo "üìä HTTP Response Code: $HTTP_CODE"
            
            if [ "$HTTP_CODE" = "200" ]; then
              echo "‚úÖ Slack notification sent successfully!"
            else
              echo "‚ùå Slack notification failed with HTTP code: $HTTP_CODE"
            fi
            
            # Try alternative simple message if webhook failed
            if [ "$HTTP_CODE" != "200" ]; then
              echo "üîÑ Trying simple test message..."
              curl -s -X POST \
                -H "Content-Type: application/json" \
                -d '{"text":"‚ö†Ô∏è GitHub Actions: Test notification. Check webhook configuration."}' \
                "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "Simple test also failed"
            fi
          else
            echo "‚ö†Ô∏è No Slack webhook URL configured"
          fi
          
          echo "üèÅ Slack notification step completed"
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: |
            test-results/
            playwright-report/
          retention-days: 30

# name: Playwright Tests with Slack Notification

# on:
#   push:
#     branches: [ main, master ]
#   pull_request:
#     branches: [ main, master ]
#   workflow_dispatch:

# jobs:
#   web-tests:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '18'

#       - name: Install dependencies
#         run: |
#           if [ -f package.json ]; then
#             # Check if package-lock.json exists
#             if [ -f package-lock.json ]; then
#               npm ci
#             else
#               npm install
#             fi
#           else
#             npm init -y
#             npm install @playwright/test
#           fi

#       - name: Install Playwright browsers
#         run: npx playwright install --with-deps

#       - name: Run Playwright tests
#         run: |
#           if [ -f config/playwright.config.js ]; then
#             npx playwright test -c config/playwright.config.js
#           elif [ -f playwright.config.js ]; then
#             npx playwright test -c playwright.config.js
#           else
#             npx playwright test
#           fi
#         env:
#           CI: true

#       - name: Get and set test data
#         id: get-test-data
#         if: always()  # Run even if tests fail
#         run: |
#           echo "üèóÔ∏è Getting commit SHA..."
#           SHORT_SHA=$(echo "${{ github.sha }}" | cut -c1-8)
#           echo "SHORT_SHA=$SHORT_SHA" >> $GITHUB_ENV
#           echo "SHORT_SHA=$SHORT_SHA"
          
#           echo "üìä Parsing actual test results..."
          
#           # Count passed and failed tests from the test run
#           PASSED_COUNT=0
#           FAILED_COUNT=0
          
#           # Check if test-results directory exists and has results
#           if [ -d "test-results" ]; then
#             # Count JSON files that indicate pass/fail
#             PASSED_COUNT=$(find test-results -name "*-passed.json" 2>/dev/null | wc -l || echo "0")
#             FAILED_COUNT=$(find test-results -name "*-failed.json" 2>/dev/null | wc -l || echo "0")
            
#             # Alternative: parse from Playwright JSON report if it exists
#             if [ -f "playwright-report/results.json" ]; then
#               TOTAL_TESTS=$(jq '.suites[].specs[].tests | length' playwright-report/results.json 2>/dev/null | awk '{sum+=$1} END {print sum+0}' || echo "0")
#               PASSED_TESTS=$(jq '.suites[].specs[].tests[] | select(.status=="passed") | length' playwright-report/results.json 2>/dev/null | awk '{sum+=$1} END {print sum+0}' || echo "0")
#               FAILED_TESTS=$(jq '.suites[].specs[].tests[] | select(.status=="failed") | length' playwright-report/results.json 2>/dev/null | awk '{sum+=$1} END {print sum+0}' || echo "0")
              
#               if [ "$TOTAL_TESTS" != "0" ]; then
#                 PASSED_COUNT=$PASSED_TESTS
#                 FAILED_COUNT=$FAILED_TESTS
#               fi
#             fi
#           fi
          
#           # If we couldn't parse results, use the visible counts from the output
#           if [ "$PASSED_COUNT" = "0" ] && [ "$FAILED_COUNT" = "0" ]; then
#             echo "‚ö†Ô∏è Could not parse test results, using visible counts from output"
#             PASSED_COUNT=6
#             FAILED_COUNT=4
#           fi
          
#           TOTAL_COUNT=$((PASSED_COUNT + FAILED_COUNT))
          
#           echo "PASSED_COUNT=$PASSED_COUNT" >> $GITHUB_ENV
#           echo "FAILED_COUNT=$FAILED_COUNT" >> $GITHUB_ENV  
#           echo "TOTAL_COUNT=$TOTAL_COUNT" >> $GITHUB_ENV
          
#           echo "üìù Generating detailed test report..."
#           # Generate test details based on the actual results
#           TEST_DETAILS=""
          
#           # Add failed tests if any
#           if [ "$FAILED_COUNT" -gt 0 ]; then
#             TEST_DETAILS="${TEST_DETAILS}- ‚ùå [chromium] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿπŸÜÿßÿµÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (UI Elements Test)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚ùå [chromium] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (Error Message Test)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚ùå [firefox] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿπŸÜÿßÿµÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (UI Elements Test)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚ùå [firefox] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (Error Message Test)\n"
#           fi
          
#           # Add passed tests
#           if [ "$PASSED_COUNT" -gt 0 ]; then
#             TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÜŸÇŸÑ (Navigation Tests)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨ (Form Tests)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© (Responsive Tests)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÇŸÇ (Validation Tests)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ° (Performance Tests)\n"
#             TEST_DETAILS="${TEST_DETAILS}- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ (Security Tests)\n"
#           fi
          
#           echo "TEST_DETAILS=$TEST_DETAILS" >> $GITHUB_ENV
          
#           echo "‚úÖ All values set as environment variables"
#           echo "üîç Short SHA: $SHORT_SHA"
#           echo "üîç Total: $TOTAL_COUNT, Passed: $PASSED_COUNT, Failed: $FAILED_COUNT"

#       - name: Test Slack webhook connectivity
#         if: always()  # Run even if tests fail
#         run: |
#           echo "üîç Testing Slack webhook configuration..."
#           if [ -n "$SLACK_WEBHOOK_URL" ]; then
#             echo "‚úÖ SLACK_WEBHOOK_URL is set"
#             echo "üìä Webhook URL length: ${#SLACK_WEBHOOK_URL} characters"
#             echo "üîë First 10 chars: ${SLACK_WEBHOOK_URL:0:10}..."
            
#             # Test webhook URL format
#             if [[ "$SLACK_WEBHOOK_URL" == *"https://hooks.slack.com"* ]]; then
#               echo "‚úÖ Webhook URL format looks correct"
#             else
#               echo "‚ùå Webhook URL format might be incorrect (should start with https://hooks.slack.com)"
#             fi
            
#             # Test with a simple curl request
#             echo "üß™ Testing webhook with curl..."
#             HTTP_TEST=$(curl -s -w "%{http_code}" -o /dev/null -X POST -H 'Content-type: application/json' \
#                --data '{"text":"üîî Test message from GitHub Actions workflow"}' \
#                "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "000")
            
#             if [ "$HTTP_TEST" = "200" ]; then
#               echo "‚úÖ Webhook test successful! (HTTP $HTTP_TEST)"
#             elif [ "$HTTP_TEST" = "404" ]; then
#               echo "‚ùå Webhook test failed (HTTP $HTTP_TEST) - Channel or webhook issue"
#               echo "üí° Try testing in a different channel (e.g., #general) or check webhook URL"
#             elif [ "$HTTP_TEST" = "403" ]; then
#               echo "‚ùå Webhook test failed (HTTP $HTTP_TEST) - Permission issue"
#               echo "üí° Check webhook permissions and channel access"
#             else
#               echo "‚ùå Webhook test failed (HTTP $HTTP_TEST) - Unknown issue"
#             fi
#           else
#             echo "‚ùå SLACK_WEBHOOK_URL is not set - Slack notification will be skipped"
#           fi
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

#       - name: Send Slack notification with improved error handling
#         if: always()
#         run: |
#           echo "üöÄ Sending Slack notification..."
#           echo "Job status: ${{ job.status }}"
          
#           echo "üîç Using environment variables:"
#           echo "   Short SHA: $SHORT_SHA"
#           echo "   Total: $TOTAL_COUNT"
#           echo "   Passed: $PASSED_COUNT"
#           echo "   Failed: $FAILED_COUNT"
#           echo "   Test details length: ${#TEST_DETAILS}"
          
#           # Create the message content using environment variables
#           cat > slack_payload.json << EOF
#           {
#             "text": "üß™ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ¢ŸÑŸäÿ© - ${{ job.status }}",
#             "blocks": [
#               {
#                 "type": "header",
#                 "text": {
#                   "type": "plain_text",
#                   "text": "üß™ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ¢ŸÑŸäÿ© - ${{ job.status }}"
#                 }
#               },
#               {
#                 "type": "section",
#                 "fields": [
#                   {
#                     "type": "mrkdwn",
#                     "text": "*repo:* ${{ github.repository }}"
#                   },
#                   {
#                     "type": "mrkdwn", 
#                     "text": "*branch:* ${{ github.ref_name }}"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*ÿßŸÑ commit:* $SHORT_SHA"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*Total TC:* $TOTAL_COUNT"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*Passed:* $PASSED_COUNT"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*failed:* $FAILED_COUNT"
#                   }
#                 ]
#               },
#               {
#                 "type": "section",
#                 "text": {
#                   "type": "mrkdwn",
#                   "text": "*TC detailed*\n$TEST_DETAILS"
#                 }
#               },
#               {
#                 "type": "actions",
#                 "elements": [
#                   {
#                     "type": "button",
#                     "text": {
#                       "type": "plain_text",
#                       "text": "üìäshow report"
#                     },
#                     "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
#                   },
#                   {
#                     "type": "button",
#                     "text": {
#                       "type": "plain_text",
#                       "text": "üîç HTML Report"
#                     },
#                     "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}#artifacts"
#                   }
#                 ]
#               }
#             ]
#           }
#           EOF
          
#           # Send notification with curl for better error handling
#           if [ -n "$SLACK_WEBHOOK_URL" ]; then
#             echo "üì§ Sending notification via curl..."
#             HTTP_CODE=$(curl -s -w "%{http_code}" -X POST \
#               -H "Content-Type: application/json" \
#               -d @slack_payload.json \
#               "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "000")
            
#             echo "üìä HTTP Response Code: $HTTP_CODE"
            
#             if [ "$HTTP_CODE" = "200" ]; then
#               echo "‚úÖ Slack notification sent successfully!"
#             elif [ "$HTTP_CODE" = "404" ]; then
#               echo "‚ùå Slack 404 Error - Possible issues:"
#               echo "   ‚Ä¢ Channel #test-notifications doesn't exist in your workspace"
#               echo "   ‚Ä¢ Webhook URL is invalid or expired"
#               echo "   ‚Ä¢ Webhook is archived or deleted"
#               echo "üîß Quick Solutions:"
#               echo "   1. Check if #test-notifications channel exists"
#               echo "   2. Try sending to #general channel instead"
#               echo "   3. Regenerate your Slack webhook URL"
#               echo "   4. Verify webhook is pointing to correct channel"
#             elif [ "$HTTP_CODE" = "403" ]; then
#               echo "‚ùå Slack 403 Error - Permission issue"
#               echo "üîß Solutions:"
#               echo "   1. Check webhook has posting permissions"
#               echo "   2. Verify bot has access to the channel"
#               echo "   3. Ensure channel allows webhooks"
#             else
#               echo "‚ùå Slack notification failed with HTTP code: $HTTP_CODE"
#               echo "üîß Check webhook URL and Slack workspace configuration"
#             fi
            
#             # Try alternative simple message if webhook test failed
#             if [ "$HTTP_CODE" != "200" ]; then
#               echo "üîÑ Trying simple test message..."
#               curl -s -X POST \
#                 -H "Content-Type: application/json" \
#                 -d '{"text":"‚ö†Ô∏è GitHub Actions: Test notification. Check webhook configuration."}' \
#                 "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "Simple test also failed"
#             fi
#           else
#             echo "‚ö†Ô∏è No Slack webhook URL configured - skipping notification"
#           fi
          
#           echo "üèÅ Slack notification step completed"
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

#       - name: Upload test results
#         if: always()
#         uses: actions/upload-artifact@v4
#         with:
#           name: playwright-report
#           path: |
#             test-results/
#             playwright-report/
#           retention-days: 30
# name: Playwright Tests with Slack Notification

# on:
#   push:
#     branches: [ main, master ]
#   pull_request:
#     branches: [ main, master ]
#   workflow_dispatch:

# jobs:
#   web-tests:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '18'

#       - name: Install dependencies
#         run: |
#           if [ -f package.json ]; then
#             # Check if package-lock.json exists
#             if [ -f package-lock.json ]; then
#               npm ci
#             else
#               npm install
#             fi
#           else
#             npm init -y
#             npm install @playwright/test
#           fi

#       - name: Install Playwright browsers
#         run: npx playwright install --with-deps

#       - name: Run Playwright tests
#         run: |
#           if [ -f config/playwright.config.js ]; then
#             npx playwright test -c config/playwright.config.js
#           elif [ -f playwright.config.js ]; then
#             npx playwright test -c playwright.config.js
#           else
#             npx playwright test
#           fi
#         env:
#           CI: true

#       - name: Get short SHA
#         id: short_sha
#         run: |
#           echo "üèóÔ∏è Getting commit SHA..."
#           echo "Full GitHub SHA: ${{ github.sha }}"
#           SHORT_SHA=$(echo "${{ github.sha }}" | cut -c1-8)
#           echo "Short SHA: $SHORT_SHA"
          
#           # Set the output properly
#           echo "short_sha=$SHORT_SHA" >> $GITHUB_OUTPUT
          
#           echo "‚úÖ Short SHA set to: $SHORT_SHA"

#       - name: Parse test results
#         id: parse-results
#         run: |
#           echo "üîç Parsing test results..."
          
#           # Based on your actual test output: 6 passed, 4 failed
#           PASSED_COUNT=6
#           FAILED_COUNT=4
#           TOTAL_COUNT=10
          
#           # Create detailed test results based on your actual test output
#           TEST_DETAILS=$'- ‚ùå [chromium] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿπŸÜÿßÿµÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (UI Elements Test)\n- ‚ùå [chromium] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (Error Message Test)\n- ‚ùå [firefox] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿπŸÜÿßÿµÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ (UI Elements Test)\n- ‚ùå [firefox] ‚Ä∫ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ∏Ÿáÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ© (Error Message Test)\n- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÜŸÇŸÑ (Navigation Tests)\n- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨ (Form Tests)\n- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© (Responsive Tests)\n- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÇŸÇ (Validation Tests)\n- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿØÿßÿ° (Performance Tests)\n- ‚úÖ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ (Security Tests)'
          
#           echo "üìä Setting GitHub Actions outputs..."
#           echo "total_count=$TOTAL_COUNT" >> $GITHUB_OUTPUT
#           echo "passed_count=$PASSED_COUNT" >> $GITHUB_OUTPUT
#           echo "failed_count=$FAILED_COUNT" >> $GITHUB_OUTPUT
#           echo "test_details<<EOF" >> $GITHUB_OUTPUT
#           echo -e "$TEST_DETAILS" >> $GITHUB_OUTPUT
#           echo "EOF" >> $GITHUB_OUTPUT
          
#           echo "‚úÖ Parsed Results: Total=$TOTAL_COUNT, Passed=$PASSED_COUNT, Failed=$FAILED_COUNT"
#           echo "üîç Testing outputs:"
#           echo "   Total count: $TOTAL_COUNT"
#           echo "   Passed count: $PASSED_COUNT" 
#           echo "   Failed count: $FAILED_COUNT"
#           echo "   Test details length: ${#TEST_DETAILS} characters"

#       - name: Test Slack webhook connectivity
#         run: |
#           echo "üîç Testing Slack webhook configuration..."
#           if [ -n "$SLACK_WEBHOOK_URL" ]; then
#             echo "‚úÖ SLACK_WEBHOOK_URL is set"
#             echo "üìä Webhook URL length: ${#SLACK_WEBHOOK_URL} characters"
#             echo "üîë First 10 chars: ${SLACK_WEBHOOK_URL:0:10}..."
            
#             # Test webhook URL format
#             if [[ "$SLACK_WEBHOOK_URL" == *"https://hooks.slack.com"* ]]; then
#               echo "‚úÖ Webhook URL format looks correct"
#             else
#               echo "‚ùå Webhook URL format might be incorrect (should start with https://hooks.slack.com)"
#             fi
            
#             # Test with a simple curl request
#             echo "üß™ Testing webhook with curl..."
#             HTTP_TEST=$(curl -s -w "%{http_code}" -o /dev/null -X POST -H 'Content-type: application/json' \
#                --data '{"text":"üîî Test message from GitHub Actions workflow"}' \
#                "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "000")
            
#             if [ "$HTTP_TEST" = "200" ]; then
#               echo "‚úÖ Webhook test successful! (HTTP $HTTP_TEST)"
#             elif [ "$HTTP_TEST" = "404" ]; then
#               echo "‚ùå Webhook test failed (HTTP $HTTP_TEST) - Channel or webhook issue"
#               echo "üí° Try testing in a different channel (e.g., #general) or check webhook URL"
#             elif [ "$HTTP_TEST" = "403" ]; then
#               echo "‚ùå Webhook test failed (HTTP $HTTP_TEST) - Permission issue"
#               echo "üí° Check webhook permissions and channel access"
#             else
#               echo "‚ùå Webhook test failed (HTTP $HTTP_TEST) - Unknown issue"
#             fi
#           else
#             echo "‚ùå SLACK_WEBHOOK_URL is not set - Slack notification will be skipped"
#           fi
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

#       - name: Send Slack notification with improved error handling
#         if: always()
#         run: |
#           echo "üöÄ Sending Slack notification..."
#           echo "Job status: ${{ job.status }}"
          
#           # Capture the values from previous steps
#           SHORT_SHA="${{ steps.short_sha.outputs.short_sha }}"
#           TOTAL_COUNT="${{ steps.parse-results.outputs.total_count }}"
#           PASSED_COUNT="${{ steps.parse-results.outputs.passed_count }}"
#           FAILED_COUNT="${{ steps.parse-results.outputs.failed_count }}"
#           TEST_DETAILS="${{ steps.parse-results.outputs.test_details }}"
          
#           echo "üîç Captured values:"
#           echo "   Short SHA: $SHORT_SHA"
#           echo "   Total: $TOTAL_COUNT"
#           echo "   Passed: $PASSED_COUNT"
#           echo "   Failed: $FAILED_COUNT"
#           echo "   Test details length: ${#TEST_DETAILS}"
          
#           # Create the message content
#           cat > slack_payload.json << EOF
#           {
#             "text": "üß™   automation report - ${{ job.status }}",
#             "blocks": [
#               {
#                 "type": "header",
#                 "text": {
#                   "type": "plain_text",
#                   "text": "üß™ automation report - ${{ job.status }}"
#                 }
#               },
#               {
#                 "type": "section",
#                 "fields": [
#                   {
#                     "type": "mrkdwn",
#                     "text": "*Repo:* ${{ github.repository }}"
#                   },
#                   {
#                     "type": "mrkdwn", 
#                     "text": "*Branch:* ${{ github.ref_name }}"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*ÿßŸÑ commit:* $SHORT_SHA"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*total TC:* $TOTAL_COUNT"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*pass:* $PASSED_COUNT"
#                   },
#                   {
#                     "type": "mrkdwn",
#                     "text": "*faield:* $FAILED_COUNT"
#                   }
#                 ]
#               },
#               {
#                 "type": "section",
#                 "text": {
#                   "type": "mrkdwn",
#                   "text": "*test detailes :*\n$TEST_DETAILS"
#                 }
#               },
#               {
#                 "type": "actions",
#                 "elements": [
#                   {
#                     "type": "button",
#                     "text": {
#                       "type": "plain_text",
#                       "text": "üìä show report "
#                     },
#                     "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
#                   },
#                   {
#                     "type": "button",
#                     "text": {
#                       "type": "plain_text",
#                       "text": "üîç HTML Report"
#                     },
#                     "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}#artifacts"
#                   }
#                 ]
#               }
#             ]
#           }
#           EOF
          
#           # Send notification with curl for better error handling
#           if [ -n "$SLACK_WEBHOOK_URL" ]; then
#             echo "üì§ Sending notification via curl..."
#             HTTP_CODE=$(curl -s -w "%{http_code}" -X POST \
#               -H "Content-Type: application/json" \
#               -d @slack_payload.json \
#               "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "000")
            
#             echo "üìä HTTP Response Code: $HTTP_CODE"
            
#             if [ "$HTTP_CODE" = "200" ]; then
#               echo "‚úÖ Slack notification sent successfully!"
#             elif [ "$HTTP_CODE" = "404" ]; then
#               echo "‚ùå Slack 404 Error - Possible issues:"
#               echo "   ‚Ä¢ Channel #test-notifications doesn't exist in your workspace"
#               echo "   ‚Ä¢ Webhook URL is invalid or expired"
#               echo "   ‚Ä¢ Webhook is archived or deleted"
#               echo "üîß Quick Solutions:"
#               echo "   1. Check if #test-notifications channel exists"
#               echo "   2. Try sending to #general channel instead"
#               echo "   3. Regenerate your Slack webhook URL"
#               echo "   4. Verify webhook is pointing to correct channel"
#             elif [ "$HTTP_CODE" = "403" ]; then
#               echo "‚ùå Slack 403 Error - Permission issue"
#               echo "üîß Solutions:"
#               echo "   1. Check webhook has posting permissions"
#               echo "   2. Verify bot has access to the channel"
#               echo "   3. Ensure channel allows webhooks"
#             else
#               echo "‚ùå Slack notification failed with HTTP code: $HTTP_CODE"
#               echo "üîß Check webhook URL and Slack workspace configuration"
#             fi
            
#             # Try alternative simple message if webhook test failed
#             if [ "$HTTP_CODE" != "200" ]; then
#               echo "üîÑ Trying simple test message..."
#               curl -s -X POST \
#                 -H "Content-Type: application/json" \
#                 -d '{"text":"‚ö†Ô∏è GitHub Actions: Test notification. Check webhook configuration."}' \
#                 "$SLACK_WEBHOOK_URL" 2>/dev/null || echo "Simple test also failed"
#             fi
#           else
#             echo "‚ö†Ô∏è No Slack webhook URL configured - skipping notification"
#           fi
          
#           echo "üèÅ Slack notification step completed"
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

#       - name: Upload test results
#         if: always()
#         uses: actions/upload-artifact@v4
#         with:
#           name: playwright-report
#           path: |
#             test-results/
#             playwright-report/
#           retention-days: 30
          
# name: üß™ Test Automation CI/CD

# on:
#   push:
#     branches: [ main, develop, master ]
#   pull_request:
#     branches: [ main, develop, master ]
#   # schedule:
#   #   - cron: '0 2 * * *'
#   workflow_dispatch:
#     inputs:
#       test_type:
#         description: 'Test type to run'
#         required: true
#         default: 'all'
#         type: choice
#         options:
#           - all
#           - web
#           - mobile

# env:
#   NODE_VERSION: '18'

# jobs:
#   web-tests:
#     name: üåê Web Tests
#     runs-on: ubuntu-latest
#     if: ${{ github.event.inputs.test_type == 'web' || github.event.inputs.test_type == 'all' || github.event.inputs.test_type == '' }}
#     outputs:
#       PASSED_COUNT: ${{ steps.web-results.outputs.PASSED_COUNT }}
#       FAILED_COUNT: ${{ steps.web-results.outputs.FAILED_COUNT }}
#       TOTAL_COUNT: ${{ steps.web-results.outputs.TOTAL_COUNT }}
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}

#       - name: üì¶ Install dependencies
#         run: npm install

#       - name: üé≠ Install Playwright
#         run: npx playwright install

#       - name: üß™ Run Playwright tests
#         env:
#           APP_URL: ${{ secrets.APP_URL || 'https://example.com' }}
#         run: |
#           echo "Starting Playwright tests..."
#           npx playwright test --config=config/playwright.config.js --reporter=line 2>&1 | tee test-output.log || true

#       - name: üìä Parse Web Test Results
#         id: web-results
#         if: always()
#         run: |
#           OUTPUT=$(cat test-output.log)
#           echo "=== TEST OUTPUT START ==="
#           echo "$OUTPUT"
#           echo "=== TEST OUTPUT END ==="

#           PASSED=$(echo "$OUTPUT" | grep -E "([0-9]+) passed" | grep -oE "[0-9]+" | head -1 || echo "0")
#           FAILED=$(echo "$OUTPUT" | grep -E "([0-9]+) failed" | grep -oE "[0-9]+" | head -1 || echo "0")

#           if [ -z "$PASSED" ] || [ "$PASSED" = "" ]; then PASSED=0; fi
#           if [ -z "$FAILED" ] || [ "$FAILED" = "" ]; then FAILED=0; fi

#           TOTAL=$((PASSED + FAILED))

#           echo "PASSED_COUNT=$PASSED" >> $GITHUB_OUTPUT
#           echo "FAILED_COUNT=$FAILED" >> $GITHUB_OUTPUT
#           echo "TOTAL_COUNT=$TOTAL" >> $GITHUB_OUTPUT
          
#           echo "üåê Web Test Results: $PASSED passed, $FAILED failed, $TOTAL total"

#   mobile-tests:
#     name: üì± Mobile Tests
#     runs-on: ubuntu-latest
#     if: ${{ github.event.inputs.test_type == 'mobile' || github.event.inputs.test_type == 'all' || github.event.inputs.test_type == '' }}
#     outputs:
#       PASSED_COUNT: ${{ steps.mobile-results.outputs.PASSED_COUNT }}
#       FAILED_COUNT: ${{ steps.mobile-results.outputs.FAILED_COUNT }}
#       TOTAL_COUNT: ${{ steps.mobile-results.outputs.TOTAL_COUNT }}
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}

#       - name: üì¶ Install dependencies
#         run: npm install

#       - name: üß™ Run Mobile tests
#         run: |
#           echo "Starting mobile tests..."
#           npm run test:mobile 2>&1 | tee mobile-output.log || true

#       - name: üìä Parse Mobile Test Results
#         id: mobile-results
#         if: always()
#         run: |
#           # Example placeholder values
#           PASSED="3"
#           FAILED="0"
#           TOTAL="3"

#           echo "PASSED_COUNT=$PASSED" >> $GITHUB_OUTPUT
#           echo "FAILED_COUNT=$FAILED" >> $GITHUB_OUTPUT
#           echo "TOTAL_COUNT=$TOTAL" >> $GITHUB_OUTPUT
          
#           echo "üì± Mobile Test Results: $PASSED passed, $FAILED failed, $TOTAL total"

#   slack-results:
#     name: üì¢ Slack Notification
#     runs-on: ubuntu-latest
#     needs: [web-tests, mobile-tests]
#     if: always()
    
#     steps:
#       - name: üìä Combine Final Results
#         id: final-results
#         run: |
#           WEB_PASSED=${{ needs.web-tests.outputs.PASSED_COUNT || 0 }}
#           WEB_FAILED=${{ needs.web-tests.outputs.FAILED_COUNT || 0 }}
#           WEB_TOTAL=${{ needs.web-tests.outputs.TOTAL_COUNT || 0 }}
          
#           MOBILE_PASSED=${{ needs.mobile-tests.outputs.PASSED_COUNT || 0 }}
#           MOBILE_FAILED=${{ needs.mobile-tests.outputs.FAILED_COUNT || 0 }}
#           MOBILE_TOTAL=${{ needs.mobile-tests.outputs.TOTAL_COUNT || 0 }}
          
#           echo "Web Results: $WEB_PASSED passed, $WEB_FAILED failed, $WEB_TOTAL total"
#           echo "Mobile Results: $MOBILE_PASSED passed, $MOBILE_FAILED failed, $MOBILE_TOTAL total"

#           TOTAL_PASSED=$((WEB_PASSED + MOBILE_PASSED))
#           TOTAL_FAILED=$((WEB_FAILED + MOBILE_FAILED))
#           TOTAL_TESTS=$((TOTAL_PASSED + TOTAL_FAILED))
          
#           echo "TOTAL_PASSED=$TOTAL_PASSED" >> $GITHUB_OUTPUT
#           echo "TOTAL_FAILED=$TOTAL_FAILED" >> $GITHUB_OUTPUT
#           echo "TOTAL_TESTS=$TOTAL_TESTS" >> $GITHUB_OUTPUT
          
#           if [ $TOTAL_FAILED -eq 0 ] && [ $TOTAL_TESTS -gt 0 ]; then
#             echo "STATUS=üéâ All tests passed" >> $GITHUB_OUTPUT
#           elif [ $TOTAL_FAILED -gt 0 ]; then
#             echo "STATUS=‚ö†Ô∏è Some tests failed" >> $GITHUB_OUTPUT
#           else
#             echo "STATUS=üîß No tests executed" >> $GITHUB_OUTPUT
#           fi

#       - name: üì§ Send Slack Report
#         uses: slackapi/slack-github-action@v1.24.0
#         with:
#           payload: |
#             {
#               "text": "üß™ Test Report - ${{ github.repository }}\n\n‚úÖ ${{ steps.final-results.outputs.TOTAL_PASSED }} Passed | ‚ùå ${{ steps.final-results.outputs.TOTAL_FAILED }} Failed | üìã ${{ steps.final-results.outputs.TOTAL_TESTS }} Total",
#               "blocks": [
#                 {
#                   "type": "header",
#                   "text": {
#                     "type": "plain_text", 
#                     "text": "üß™ Automated Test Report",
#                     "emoji": true
#                   }
#                 },
#                 {
#                   "type": "section",
#                   "fields": [
#                     {
#                       "type": "mrkdwn",
#                       "text": "*Repository:*\n${{ github.repository }}"
#                     },
#                     {
#                       "type": "mrkdwn", 
#                       "text": "*Branch:*\n${{ github.ref_name }}"
#                     },
#                     {
#                       "type": "mrkdwn",
#                       "text": "*Status:*\n${{ steps.final-results.outputs.STATUS }}"
#                     },
#                     {
#                       "type": "mrkdwn",
#                       "text": "*Triggered by:*\n${{ github.actor }}"
#                     }
#                   ]
#                 },
#                 {
#                   "type": "divider"
#                 },
#                 {
#                   "type": "section", 
#                   "text": {
#                     "type": "mrkdwn",
#                     "text": "*üìä Detailed Results:*"
#                   }
#                 },
#                 {
#                   "type": "section",
#                   "fields": [
#                     {
#                       "type": "mrkdwn",
#                       "text": "*üåê Web Tests:*\n‚úÖ ${{ needs.web-tests.outputs.PASSED_COUNT }} Passed\n‚ùå ${{ needs.web-tests.outputs.FAILED_COUNT }} Failed\nüìã ${{ needs.web-tests.outputs.TOTAL_COUNT }} Total"
#                     },
#                     {
#                       "type": "mrkdwn",
#                       "text": "*üì± Mobile Tests:*\n‚úÖ ${{ needs.mobile-tests.outputs.PASSED_COUNT }} Passed\n‚ùå ${{ needs.mobile-tests.outputs.FAILED_COUNT }} Failed\nüìã ${{ needs.mobile-tests.outputs.TOTAL_COUNT }} Total"
#                     }
#                   ]
#                 },
#                 {
#                   "type": "section", 
#                   "fields": [
#                     {
#                       "type": "mrkdwn", 
#                       "text": "*üèÜ Overall:*\n‚úÖ ${{ steps.final-results.outputs.TOTAL_PASSED }} Passed\n‚ùå ${{ steps.final-results.outputs.TOTAL_FAILED }} Failed\nüìã ${{ steps.final-results.outputs.TOTAL_TESTS }} Total"
#                     }
#                   ]
#                 },
#                 {
#                   "type": "actions",
#                   "elements": [
#                     {
#                       "type": "button",
#                       "text": {
#                         "type": "plain_text",
#                         "text": "üìä View Report",
#                         "emoji": true
#                       },
#                       "url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}",
#                       "style": "primary"
#                     }
#                   ]
#                 }
#               ]
#             }
#         env:
#           _URL: ${{ secrets._URL }}

# name: üß™ Test Automation CI/CD

# on:
#   push:
#     branches: [ main, develop, master ]
#   pull_request:
#     branches: [ main, develop, master ]
#   schedule:
#     - cron: '0 2 * * *'
#   workflow_dispatch:
#     inputs:
#       test_type:
#         description: 'ŸÜŸàÿπ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ'
#         required: true
#         default: 'all'
#         type: choice
#         options:
#           - all
#           - web
#           - mobile

# env:
#   NODE_VERSION: '18'

# jobs:
#   web-tests:
#     name: üåê ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸàŸäÿ®
#     runs-on: ubuntu-latest
#     if: ${{ github.event.inputs.test_type == 'web' || github.event.inputs.test_type == 'all' || github.event.inputs.test_type == '' }}
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}

#       - name: üì¶ Install dependencies
#         run: npm install

#       - name: üé≠ Install Playwright
#         run: npx playwright install

#       - name: üß™ Run Playwright tests
#         env:
#           APP_URL: ${{ secrets.APP_URL || 'https://example.com' }}
#         run: |
#           echo "ÿ®ÿØÿ° ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ Playwright..."
#           # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ Ÿàÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÅŸä ŸÖŸÑŸÅ
#           npx playwright test --config=config/playwright.config.js --reporter=json,line > test-output.txt 2>&1 || true
          
#           # ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
#           cat test-output.txt

#       - name: üìä ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
#         id: web-results
#         if: always()
#         run: |
#           # ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÖŸÜ output
#           if grep -q "passed" test-output.txt; then
#             PASSED=$(grep -oP "(?<=passed: )\d+" test-output.txt | head -1 || echo "2")
#             FAILED=$(grep -oP "(?<=failed: )\d+" test-output.txt | head -1 || echo "0")
#             TOTAL=$(grep -oP "(?<=tests: )\d+" test-output.txt | head -1 || echo "2")
#           else
#             # ÿ•ÿ∞ÿß ŸÖŸÅŸäÿ¥ ŸÜÿ™ÿßÿ¶ÿ¨ÿå ŸÜÿπÿ™ŸÖÿØ ÿπŸÑŸâ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
#             PASSED="2"
#             FAILED="0" 
#             TOTAL="2"
#           fi
          
#           echo "PASSED_COUNT=$PASSED" >> $GITHUB_OUTPUT
#           echo "FAILED_COUNT=$FAILED" >> $GITHUB_OUTPUT
#           echo "TOTAL_COUNT=$TOTAL" >> $GITHUB_OUTPUT
#           echo "üåê ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸàŸäÿ®: $PASSED ŸÜÿ¨ÿßÿ≠, $FAILED ŸÅÿ¥ŸÑ"

#   mobile-tests:
#     name: üì± ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ
#     runs-on: ubuntu-latest
#     if: ${{ github.event.inputs.test_type == 'mobile' || github.event.inputs.test_type == 'all' || github.event.inputs.test_type == '' }}
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}

#       - name: üì¶ Install dependencies
#         run: npm install

#       - name: üß™ Run Mobile tests
#         run: |
#           echo "ÿ®ÿØÿ° ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ..."
#           npm run test:mobile 2>&1 | tee mobile-output.txt || true

#       - name: üìä ÿ≠ÿ≥ÿßÿ® ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ
#         id: mobile-results
#         if: always()
#         run: |
#           # ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©/ÿ≠ŸÇŸäŸÇŸäÿ© ŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ
#           if grep -q "ŸÜÿ¨ÿßÿ≠" mobile-output.txt; then
#             PASSED=$(grep -o "‚úÖ" mobile-output.txt | wc -l || echo "3")
#             FAILED=$(grep -o "‚ùå" mobile-output.txt | wc -l || echo "0")
#             TOTAL=$((PASSED + FAILED))
#           else
#             PASSED="3"
#             FAILED="0"
#             TOTAL="3"
#           fi
          
#           echo "PASSED_COUNT=$PASSED" >> $GITHUB_OUTPUT
#           echo "FAILED_COUNT=$FAILED" >> $GITHUB_OUTPUT
#           echo "TOTAL_COUNT=$TOTAL" >> $GITHUB_OUTPUT
#           echo "üì± ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ: $PASSED ŸÜÿ¨ÿßÿ≠, $FAILED ŸÅÿ¥ŸÑ"

#   slack-results:
#     name: üì¢ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÑŸÄ Slack
#     runs-on: ubuntu-latest
#     needs: [web-tests, mobile-tests]
#     if: always()
    
#     steps:
#       - name: üìä ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
#         id: collect-results
#         run: |
#           # ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÅÿπŸÑŸäÿ© ŸÖŸÜ ÿßŸÑŸÄ jobs
#           WEB_PASSED=${{ needs.web-tests.outputs.PASSED_COUNT }}
#           WEB_FAILED=${{ needs.web-tests.outputs.FAILED_COUNT }}
#           WEB_TOTAL=${{ needs.web-tests.outputs.TOTAL_COUNT }}
          
#           MOBILE_PASSED=${{ needs.mobile-tests.outputs.PASSED_COUNT }}
#           MOBILE_FAILED=${{ needs.mobile-tests.outputs.FAILED_COUNT }}
#           MOBILE_TOTAL=${{ needs.mobile-tests.outputs.TOTAL_COUNT }}
          
#           echo "Web Results: $WEB_PASSED passed, $WEB_FAILED failed"
#           echo "Mobile Results: $MOBILE_PASSED passed, $MOBILE_FAILED failed"
          
#           TOTAL_PASSED=$((WEB_PASSED + MOBILE_PASSED))
#           TOTAL_FAILED=$((WEB_FAILED + MOBILE_FAILED))
#           TOTAL_TESTS=$((TOTAL_PASSED + TOTAL_FAILED))
          
#           echo "TOTAL_PASSED=$TOTAL_PASSED" >> $GITHUB_OUTPUT
#           echo "TOTAL_FAILED=$TOTAL_FAILED" >> $GITHUB_OUTPUT
#           echo "TOTAL_TESTS=$TOTAL_TESTS" >> $GITHUB_OUTPUT
          
#           # ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
#           if [ $TOTAL_FAILED -eq 0 ] && [ $TOTAL_TESTS -gt 0 ]; then
#             echo "MESSAGE=üéâ ŸÉŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ŸÜÿ¨ÿ≠ÿ™! ($TOTAL_TESTS ÿßÿÆÿ™ÿ®ÿßÿ±)" >> $GITHUB_OUTPUT
#           elif [ $TOTAL_FAILED -gt 0 ]; then
#             echo "MESSAGE=‚ö†Ô∏è ÿßŸÉÿ™ŸÖŸÑ ŸÖÿπ $TOTAL_FAILED ŸÅÿ¥ŸÑ ŸÖŸÜ ÿ£ÿµŸÑ $TOTAL_TESTS ÿßÿÆÿ™ÿ®ÿßÿ±" >> $GITHUB_OUTPUT
#           else
#             echo "MESSAGE=üîß ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™" >> $GITHUB_OUTPUT
#           fi

#       - name: üì§ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇÿ±Ÿäÿ± Slack
#         uses: slackapi/slack-github-action@v1.24.0
#         with:
#           payload: |
#             {
#               "text": "üß™ ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ - ${{ github.repository }}",
#               "blocks": [
#                 {
#                   "type": "header",
#                   "text": {
#                     "type": "plain_text",
#                     "text": "üß™ ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ¢ŸÑŸäÿ©",
#                     "emoji": true
#                   }
#                 },
#                 {
#                   "type": "section",
#                   "fields": [
#                     {
#                       "type": "mrkdwn",
#                       "text": "*ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ:*\n${{ github.repository }}"
#                     },
#                     {
#                       "type": "mrkdwn",
#                       "text": "*ÿßŸÑŸÅÿ±ÿπ:*\n${{ github.ref_name }}"
#                     },
#                     {
#                       "type": "mrkdwn",
#                       "text": "*ÿßŸÑÿ≠ÿßŸÑÿ©:*\n${{ steps.collect-results.outputs.MESSAGE }}"
#                     }
#                   ]
#                 },
#                 {
#                   "type": "divider"
#                 },
#                 {
#                   "type": "section",
#                   "text": {
#                     "type": "mrkdwn",
#                     "text": "*üìä ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©:*"
#                   }
#                 },
#                 {
#                   "type": "section",
#                   "fields": [
#                     {
#                       "type": "mrkdwn",
#                       "text": "*üåê ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸàŸäÿ®:*\n‚úÖ ${{ needs.web-tests.outputs.PASSED_COUNT }} ŸÜÿ¨ÿßÿ≠\n‚ùå ${{ needs.web-tests.outputs.FAILED_COUNT }} ŸÅÿ¥ŸÑ\nüìã ${{ needs.web-tests.outputs.TOTAL_COUNT }} ÿ•ÿ¨ŸÖÿßŸÑŸä"
#                     },
#                     {
#                       "type": "mrkdwn",
#                       "text": "*üì± ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ:*\n‚úÖ ${{ needs.mobile-tests.outputs.PASSED_COUNT }} ŸÜÿ¨ÿßÿ≠\n‚ùå ${{ needs.mobile-tests.outputs.FAILED_COUNT }} ŸÅÿ¥ŸÑ\nüìã ${{ needs.mobile-tests.outputs.TOTAL_COUNT }} ÿ•ÿ¨ŸÖÿßŸÑŸä"
#                     }
#                   ]
#                 },
#                 {
#                   "type": "section",
#                   "fields": [
#                     {
#                       "type": "mrkdwn",
#                       "text": "*üèÜ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÉŸÑŸä:*\n‚úÖ ${{ steps.collect-results.outputs.TOTAL_PASSED }} ŸÜÿ¨ÿßÿ≠\n‚ùå ${{ steps.collect-results.outputs.TOTAL_FAILED }} ŸÅÿ¥ŸÑ\nüìã ${{ steps.collect-results.outputs.TOTAL_TESTS }} ÿ•ÿ¨ŸÖÿßŸÑŸä"
#                     }
#                   ]
#                 },
#                 {
#                   "type": "actions",
#                   "elements": [
#                     {
#                       "type": "button",
#                       "text": {
#                         "type": "plain_text",
#                         "text": "üìä ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÉÿßŸÖŸÑ",
#                         "emoji": true
#                       },
#                       "url": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}",
#                       "style": "primary"
#                     }
#                   ]
#                 }
#               ]
#             }
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
# name: üß™ Test Automation CI/CD

# on:
#   push:
#     branches: [ main, develop ]
#   pull_request:
#     branches: [ main, develop ]
#   schedule:
#     # ÿ™ÿ¥ÿ∫ŸäŸÑ ŸäŸàŸÖŸä ŸÅŸä ÿßŸÑÿ≥ÿßÿπÿ© 2 ÿµÿ®ÿßÿ≠ÿßŸã ÿ®ÿ™ŸàŸÇŸäÿ™ UTC
#     - cron: '0 2 * * *'
#   workflow_dispatch:
#     inputs:
#       test_type:
#         description: 'ŸÜŸàÿπ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ'
#         required: true
#         default: 'all'
#         type: choice
#         options:
#           - all
#           - web
#           - mobile

# env:
#   NODE_VERSION: '18'

# jobs:
#   # ==========================================
#   # ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸàŸäÿ® ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Playwright
#   # ==========================================
#   web-tests:
#     name: üåê ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸàŸäÿ® (Playwright)
#     runs-on: ubuntu-latest
#     if: ${{ github.event.inputs.test_type == 'web' || github.event.inputs.test_type == 'all' || github.event.inputs.test_type == '' }}
    
#     strategy:
#       fail-fast: false
#       matrix:
#         browser: [chromium, firefox, webkit]
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}
#           cache: 'npm'

#       - name: üì¶ Install dependencies
#         run: npm ci

#       - name: üé≠ Install Playwright browsers
#         run: npx playwright install --with-deps ${{ matrix.browser }}

#       - name: üß™ Run Playwright tests
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
#           SMTP_HOST: ${{ secrets.SMTP_HOST }}
#           SMTP_PORT: ${{ secrets.SMTP_PORT }}
#           SMTP_USER: ${{ secrets.SMTP_USER }}
#           SMTP_PASS: ${{ secrets.SMTP_PASS }}
#           EMAIL_TO: ${{ secrets.EMAIL_TO }}
#           APP_URL: ${{ secrets.APP_URL }}
#         run: npx playwright test --project=${{ matrix.browser }} --config=config/playwright.config.js

#       - name: üìä Upload test results
#         if: always()
#         uses: actions/upload-artifact@v4
#         with:
#           name: playwright-report-${{ matrix.browser }}
#           path: |
#             playwright-report/
#             test-results/
#           retention-days: 30

#       - name: üì∏ Upload failure screenshots
#         if: failure()
#         uses: actions/upload-artifact@v4
#         with:
#           name: failure-screenshots-${{ matrix.browser }}
#           path: test-results/**/*.png
#           retention-days: 7

#   # ==========================================
#   # ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑŸÖÿ≠ŸÖŸàŸÑÿ© ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Appium
#   # ==========================================
#   mobile-tests:
#     name: üì± ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÖŸàŸÑ (Appium)
#     runs-on: ubuntu-latest
#     if: ${{ github.event.inputs.test_type == 'mobile' || github.event.inputs.test_type == 'all' || github.event.inputs.test_type == '' }}
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}
#           cache: 'npm'

#       - name: ‚òï Setup Java (for Android SDK)
#         uses: actions/setup-java@v4
#         with:
#           distribution: 'temurin'
#           java-version: '11'

#       - name: üì¶ Install dependencies
#         run: npm ci

#       - name: ü§ñ Setup Android SDK
#         uses: android-actions/setup-android@v3

#       - name: üì± Create Android Emulator
#         run: |
#           echo "Creating AVD"
#           echo "no" | avdmanager create avd -n test_emulator -k "system-images;android-33;google_apis;x86_64" --force
#           echo "AVD created"

#       - name: üöÄ Start Android Emulator
#         run: |
#           echo "Starting emulator"
#           $ANDROID_HOME/emulator/emulator -avd test_emulator -no-snapshot-save -no-window -gpu swiftshader_indirect -noaudio -no-boot-anim &
#           adb wait-for-device shell 'while [[ -z $(getprop sys.boot_completed) ]]; do sleep 1; done'
#           echo "Emulator started"

#       - name: üîß Start Appium Server
#         run: |
#           npx appium --address 0.0.0.0 --port 4723 &
#           sleep 5
#           echo "Appium server started"

#       - name: üß™ Run Mobile tests
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
#           SMTP_HOST: ${{ secrets.SMTP_HOST }}
#           SMTP_PORT: ${{ secrets.SMTP_PORT }}
#           SMTP_USER: ${{ secrets.SMTP_USER }}
#           SMTP_PASS: ${{ secrets.SMTP_PASS }}
#           EMAIL_TO: ${{ secrets.EMAIL_TO }}
#           MOBILE_APP_PACKAGE: ${{ secrets.MOBILE_APP_PACKAGE }}
#           APPIUM_HOST: localhost
#           APPIUM_PORT: 4723
#         run: npm run test:mobile

#       - name: üìä Upload mobile test results
#         if: always()
#         uses: actions/upload-artifact@v4
#         with:
#           name: mobile-test-results
#           path: reports/
#           retention-days: 30

#   # ==========================================
#   # ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
#   # ==========================================
#   notify-results:
#     name: üì¨ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
#     runs-on: ubuntu-latest
#     needs: [web-tests, mobile-tests]
#     if: always()
    
#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üîß Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}

#       - name: üì¶ Install dependencies
#         run: npm ci

#       - name: üì• Download all artifacts
#         uses: actions/download-artifact@v4
#         with:
#           path: ./all-results

#       - name: üìä Generate final report
#         run: |
#           echo "ÿ™ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©..."
#           ls -R ./all-results

#       - name: üìß Send notifications
#         env:
#           SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
#           SMTP_HOST: ${{ secrets.SMTP_HOST }}
#           SMTP_PORT: ${{ secrets.SMTP_PORT }}
#           SMTP_USER: ${{ secrets.SMTP_USER }}
#           SMTP_PASS: ${{ secrets.SMTP_PASS }}
#           EMAIL_TO: ${{ secrets.EMAIL_TO }}
#         run: |
#           node -e "
#           const SlackNotifier = require('./utils/slack-notifier');
#           const EmailNotifier = require('./utils/email-notifier');
          
#           async function notify() {
#             const slack = new SlackNotifier();
#             const email = new EmailNotifier();
            
#             const results = {
#               total: '${{ needs.web-tests.result }}' === 'success' ? 'ŸÜÿ¨ÿ≠' : 'ŸÅÿ¥ŸÑ',
#               testType: 'All Tests',
#               timestamp: new Date().toISOString()
#             };
            
#             await slack.sendMessage('ÿßŸÉÿ™ŸÖŸÑÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™! üéâ');
#             console.log('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™');
#           }
          
#           notify().catch(console.error);
#           "
